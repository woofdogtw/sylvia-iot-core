<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Configuration - Sylvia-IoT Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Sylvia-IoT Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>This chapter describes the configuration format and usage of Sylvia-IoT.</p>
<p>Sylvia-IoT supports four sources of configuration, prioritized as follows (from highest to lowest):</p>
<ul>
<li>JSON5 configuration file</li>
<li>Command-line parameters</li>
<li>Environment variables</li>
<li>Internal default values (may not exist; if required but not provided, an error message will be
displayed)</li>
</ul>
<p>You can refer to
<a href="https://github.com/woofdogtw/sylvia-iot-core/blob/main/files/config.json5.example"><strong>the sample JSON5 file</strong></a>
for a complete list of configuration options. This chapter will provide corresponding explanations.
The following conventions apply to the configuration:</p>
<ul>
<li>The nested structure in JSON5 is represented using <code>.</code> (dot).</li>
<li>For command-line parameters that encounter nested JSON5, the dot notation is also used.</li>
<li>For command-line parameters corresponding to camelCase JSON5 properties, they will be written in
all lowercase or with <code>-</code> followed by lowercase. For example:
<ul>
<li>JSON5 property <code>server.httpPort</code> corresponds to <code>--server.httpport</code>.</li>
<li>JSON5 property <code>broker.mqChannels</code> corresponds to <code>--broker.mq-channels</code>.</li>
</ul>
</li>
<li>Environment variables are written in all uppercase.</li>
<li>For environment variables that encounter nested JSON5, <code>_</code> (underscore) is used.</li>
<li>For environment variables corresponding to camelCase JSON5 properties, they will be written in all
uppercase or with <code>_</code> (underscore) separating words. For example:
<ul>
<li>JSON5 property <code>server.httpPort</code> corresponds to <code>SERVER_HTTP_PORT</code>.</li>
<li>JSON5 property <code>broker.mqChannels</code> corresponds to <code>BROKER_MQCHANNELS</code>.</li>
</ul>
</li>
</ul>
<p>Here are the complete table explanations:</p>
<blockquote>
<p>If marked with <strong>Refer to example</strong>, it means that the sample JSON5 is provided or you can use
the CLI <strong>help</strong> command to view the supported options.</p>
</blockquote>
<h2 id="common-settings"><a class="header" href="#common-settings">Common Settings</a></h2>
<div class="table-wrapper"><table><thead><tr><th>JSON5</th><th>CLI Parameters</th><th>Environment Variables</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td>log.level</td><td>log.level</td><td>LOG_LEVEL</td><td>info</td><td>Log level. Refer to example</td></tr>
<tr><td>log.style</td><td>log.style</td><td>LOG_STYLE</td><td>json</td><td>Log style. Refer to example</td></tr>
<tr><td>server.httpPort</td><td>log.httpport</td><td>SERVER_HTTP_PORT</td><td>1080</td><td>HTTP listening port</td></tr>
<tr><td>server.httpsPort</td><td>log.httpsport</td><td>SERVER_HTTPS_PORT</td><td>1443</td><td>HTTPS listening port</td></tr>
<tr><td>server.cacertFile</td><td>log.cacertfile</td><td>SERVER_CACERT_FILE</td><td></td><td>HTTPS root certificate file location</td></tr>
<tr><td>server.certFile</td><td>log.certfile</td><td>SERVER_CERT_FILE</td><td></td><td>HTTPS certificate file location</td></tr>
<tr><td>server.keyFile</td><td>log.keyfile</td><td>SERVER_KEY_FILE</td><td></td><td>HTTPS private key file location</td></tr>
<tr><td>server.staticPath</td><td>log.static</td><td>SERVER_STATIC_PATH</td><td></td><td>Static files directory location</td></tr>
</tbody></table>
</div>
<h3 id="detailed-explanation"><a class="header" href="#detailed-explanation">Detailed Explanation</a></h3>
<ul>
<li>Root certificate is not currently used.</li>
<li>Both certificate and private key must be used simultaneously to enable HTTPS service.</li>
</ul>
<h2 id="api-scopes"><a class="header" href="#api-scopes">API Scopes</a></h2>
<p>All APIs require access through registered clients and access tokens. Each token is associated with
a specific client, and only authorized clients can access the APIs.</p>
<p>When a particular API is configured with <code>apiScopes</code> settings, the access token must include the
relevant scopes enabled by the client during registration and authorized by the user to access that
API.</p>
<p>Both command-line parameters and environment variables should be provided as JSON strings. For
example:</p>
<pre><code>--auth.api-scopes='{"auth.tokeninfo.get":[]}'
</code></pre>
<p>You can define custom scope names and apply them to various API scopes. You can refer to the example
provided in the <strong>Authentication Service</strong> section for more details.</p>
<h2 id="authentication-service-auth"><a class="header" href="#authentication-service-auth">Authentication Service (auth)</a></h2>
<div class="table-wrapper"><table><thead><tr><th>JSON5</th><th>CLI Parameters</th><th>Environment Variables</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td>auth.db.engine</td><td>auth.db.engine</td><td>AUTH_DB_ENGINE</td><td>sqlite</td><td>Database type</td></tr>
<tr><td>auth.db.mongodb.url</td><td>auth.db.mongodb.url</td><td>AUTH_DB_MONGODB_URL</td><td>mongodb://localhost:27017</td><td>MongoDB connection URL</td></tr>
<tr><td>auth.db.mongodb.database</td><td>auth.db.mongodb.database</td><td>AUTH_DB_MONGODB_DATABASE</td><td>auth</td><td>MongoDB database name</td></tr>
<tr><td>auth.db.mongodb.poolSize</td><td>auth.db.mongodb.poolsize</td><td>AUTH_DB_MONGODB_POOLSIZE</td><td></td><td>Maximum number of MongoDB connections</td></tr>
<tr><td>auth.db.sqlite.path</td><td>auth.db.sqlite.path</td><td>AUTH_DB_SQLITE_PATH</td><td>auth.db</td><td>SQLite file location</td></tr>
<tr><td>auth.db.templates.login</td><td>auth.db.templates</td><td>AUTH_TEMPLATES</td><td></td><td>Login page template file location</td></tr>
<tr><td>auth.db.templates.grant</td><td>auth.db.templates</td><td>AUTH_TEMPLATES</td><td></td><td>Authorization page template file location</td></tr>
<tr><td>auth.db.apiScopes</td><td>auth.api-scopes</td><td>AUTH_API_SCOPES</td><td></td><td>API scope settings</td></tr>
</tbody></table>
</div>
<h3 id="detailed-explanation-1"><a class="header" href="#detailed-explanation-1">Detailed Explanation</a></h3>
<ul>
<li>Templates:
<ul>
<li>These are the web pages required for the OAuth2 authorization code grant flow.
<strong>sylvia-iot-auth</strong> provides default pages, but Sylvia-IoT allows you to customize web pages
to match your own style.</li>
<li>The templates use the Jinja2 format (dependent on the <a href="https://tera.netlify.app/"><strong>tera</strong></a>
package).</li>
<li>Both command-line parameters and environment variables should use JSON strings. For example:
<pre><code>--auth.templates='{"login":"xxx"}'
</code></pre>
</li>
<li>For more details, please refer to <a href="../dev/oauth2.html"><strong>OAuth2 Authentication</strong></a>.</li>
</ul>
</li>
<li>API scopes
<ul>
<li>The <strong>auth</strong> module provides the following scopes that can be configured for corresponding
APIs to limit the scope of access for clients:
<ul>
<li><code>auth.tokeninfo.get</code>: Authorize clients to read token data.
<ul>
<li><code>GET /api/v1/auth/tokeninfo</code></li>
</ul>
</li>
<li><code>auth.logout.post</code>: Authorize clients to log out tokens.
<ul>
<li><code>POST /auth/api/v1/auth/logout</code></li>
</ul>
</li>
<li><code>user.get</code>: Authorize clients to access current user's profile data.
<ul>
<li><code>GET /api/v1/user</code></li>
</ul>
</li>
<li><code>user.path</code>: Authorize clients to modify current user's profile data.
<ul>
<li><code>PATCH /api/v1/user</code></li>
</ul>
</li>
<li><code>user.get.admin</code>: Authorize clients to access data of all system users.
<ul>
<li><code>GET /api/v1/user/count</code></li>
<li><code>GET /api/v1/user/list</code></li>
<li><code>GET /api/v1/user/{userId}</code></li>
</ul>
</li>
<li><code>user.post.admin</code>: Authorize clients to create new users in the system.
<ul>
<li><code>POST /api/v1/user</code></li>
</ul>
</li>
<li><code>user.patch.admin</code>: Authorize clients to modify data of any system user.
<ul>
<li><code>PATCH /api/v1/user/{userId}</code></li>
</ul>
</li>
<li><code>user.delete.admin</code>: Authorize clients to delete data of any system user.
<ul>
<li><code>DELETE /api/v1/user/{userId}</code></li>
</ul>
</li>
<li><code>client.get</code>: Authorize clients to access data of all system clients.
<ul>
<li><code>GET /api/v1/client/count</code></li>
<li><code>GET /api/v1/client/list</code></li>
<li><code>GET /api/v1/client/{clientId}</code></li>
</ul>
</li>
<li><code>client.post</code>: Authorize clients to create new clients in the system.
<ul>
<li><code>POST /api/v1/client</code></li>
</ul>
</li>
<li><code>client.patch</code>: Authorize clients to modify data of any system client.
<ul>
<li><code>PATCH /api/v1/client/{clientId}</code></li>
</ul>
</li>
<li><code>client.delete</code>: Authorize clients to delete data of any system client.
<ul>
<li><code>DELETE /api/v1/client/{clientId}</code></li>
</ul>
</li>
<li><code>client.delete.user</code>: Authorize clients to delete all clients of any system user.
<ul>
<li><code>DELETE /api/v1/client/user/{userId}</code></li>
</ul>
</li>
</ul>
</li>
<li>For example, in your service, you define the following scopes:
<ul>
<li><code>api.admin</code>: Only authorize the removal of all clients of a user.</li>
<li><code>api.rw</code>: Allow read and write access to all APIs except
<code>DELETE /api/v1/client/user/{userId}</code>.</li>
<li><code>api.readonly</code>ï¼š Only allow access to GET APIs.</li>
<li>Allow access to token data and log out actions for all clients.</li>
</ul>
<pre><code>"auth": {
    ...
    "apiScopes": {
        "auth.tokeninfo.get": [],
        "auth.logout.post": [],
        "user.get": ["api.rw", "api.readonly"],
        "user.patch": ["api.rw"],
        "user.post.admin": ["api.rw"],
        "user.get.admin": ["api.rw", "api.readonly"],
        "user.patch.admin": ["api.rw"],
        "user.delete.admin": ["api.rw"],
        "client.post": ["api.rw"],
        "client.get": ["api.rw", "api.readonly"],
        "client.patch": ["api.rw"],
        "client.delete": ["api.rw"],
        "client.delete.user": ["api.admin"],
    },
    ...
}
</code></pre>
<ul>
<li>In this example, registered clients can freely select these three scopes. Subsequently,
users will be informed of this information on the authorization page and decide whether to
grant authorization to the client.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="message-broker-service-broker"><a class="header" href="#message-broker-service-broker">Message Broker Service (broker)</a></h2>
<div class="table-wrapper"><table><thead><tr><th>JSON5</th><th>CLI Parameters</th><th>Environment Variables</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td>broker.auth</td><td>broker.auth</td><td>BROKER_AUTH</td><td>http://localhost:1080/auth</td><td>Authentication service URL</td></tr>
<tr><td>broker.db.engine</td><td>broker.db.engine</td><td>BROKER_DB_ENGINE</td><td>sqlite</td><td>Database type</td></tr>
<tr><td>broker.db.mongodb.url</td><td>broker.db.mongodb.url</td><td>BROKER_DB_MONGODB_URL</td><td>mongodb://localhost:27017</td><td>MongoDB connection URL</td></tr>
<tr><td>broker.db.mongodb.database</td><td>broker.db.mongodb.database</td><td>BROKER_DB_MONGODB_DATABASE</td><td>auth</td><td>MongoDB database name</td></tr>
<tr><td>broker.db.mongodb.poolSize</td><td>broker.db.mongodb.poolsize</td><td>BROKER_DB_MONGODB_POOLSIZE</td><td></td><td>Maximum number of MongoDB connections</td></tr>
<tr><td>broker.db.sqlite.path</td><td>broker.db.sqlite.path</td><td>BROKER_DB_SQLITE_PATH</td><td>auth.db</td><td>SQLite file location</td></tr>
<tr><td>broker.cache.engine</td><td>broker.cache.engine</td><td>BROKER_CACHE_ENGINE</td><td>none</td><td>Cache type</td></tr>
<tr><td>broker.cache.memory.device</td><td>broker.cache.memory.device</td><td>BROKER_CACHE_MEMORY_DEVICE</td><td>1,000,000</td><td>Memory cache size for devices</td></tr>
<tr><td>broker.cache.memory.deviceRoute</td><td>broker.cache.memory.device-route</td><td>BROKER_CACHE_MEMORY_DEVICE_ROUTE</td><td>1,000,000</td><td>Memory cache size for device routes</td></tr>
<tr><td>broker.cache.memory.networkRoute</td><td>broker.cache.memory.network-route</td><td>BROKER_CACHE_MEMORY_NETWORK_ROUTE</td><td>1,000,000</td><td>Memory cache size for network routes</td></tr>
<tr><td>broker.mq.prefetch</td><td>broker.mq.prefetch</td><td>BROKER_MQ_PREFETCH</td><td>100</td><td>Maximum number of AMQP consumers</td></tr>
<tr><td>broker.mq.persistent</td><td>broker.mq.persistent</td><td>BROKER_MQ_PERSISTENT</td><td>false</td><td>Persistent message delivery for AMQP producers</td></tr>
<tr><td>broker.mq.sharedPrefix</td><td>broker.mq.sharedprefix</td><td>BROKER_MQ_SHAREDPREFIX</td><td>$share/sylvia-iot-broker/</td><td>MQTT shared subscription prefix</td></tr>
<tr><td>broker.mqChannels.unit.url</td><td>broker.mq-channels.unit.url</td><td>BROKER_MQCHANNELS_UNIT_URL</td><td>amqp://localhost</td><td>Unit control message host</td></tr>
<tr><td>broker.mqChannels.unit.prefetch</td><td>broker.mq-channels.unit.prefetch</td><td>BROKER_MQCHANNELS_UNIT_PREFETCH</td><td>100</td><td>Maximum number of AMQP consumers for unit control messages</td></tr>
<tr><td>broker.mqChannels.application.url</td><td>broker.mq-channels.application.url</td><td>BROKER_MQCHANNELS_APPLICATION_URL</td><td>amqp://localhost</td><td>Application control message host</td></tr>
<tr><td>broker.mqChannels.application.prefetch</td><td>broker.mq-channels.application.prefetch</td><td>BROKER_MQCHANNELS_APPLICATION_PREFETCH</td><td>100</td><td>Maximum number of AMQP consumers for application control messages</td></tr>
<tr><td>broker.mqChannels.network.url</td><td>broker.mq-channels.network.url</td><td>BROKER_MQCHANNELS_NETWORK_URL</td><td>amqp://localhost</td><td>Network control message host</td></tr>
<tr><td>broker.mqChannels.network.prefetch</td><td>broker.mq-channels.network.prefetch</td><td>BROKER_MQCHANNELS_NETWORK_PREFETCH</td><td>100</td><td>Maximum number of AMQP consumers for network control messages</td></tr>
<tr><td>broker.mqChannels.device.url</td><td>broker.mq-channels.device.url</td><td>BROKER_MQCHANNELS_DEVICE_URL</td><td>amqp://localhost</td><td>Device control message host</td></tr>
<tr><td>broker.mqChannels.device.prefetch</td><td>broker.mq-channels.device.prefetch</td><td>BROKER_MQCHANNELS_DEVICE_PREFETCH</td><td>100</td><td>Maximum number of AMQP consumers for device control messages</td></tr>
<tr><td>broker.mqChannels.deviceRoute.url</td><td>broker.mq-channels.device-route.url</td><td>BROKER_MQCHANNELS_DEVICE_ROUTE_URL</td><td>amqp://localhost</td><td>Device route control message host</td></tr>
<tr><td>broker.mqChannels.deviceRoute.prefetch</td><td>broker.mq-channels.device-route.prefetch</td><td>BROKER_MQCHANNELS_DEVICE_ROUTE_PREFETCH</td><td>100</td><td>Maximum number of AMQP consumers for device route control messages</td></tr>
<tr><td>broker.mqChannels.networkRoute.url</td><td>broker.mq-channels.network-route.url</td><td>BROKER_MQCHANNELS_NETWORK_ROUTE_URL</td><td>amqp://localhost</td><td>Network route control message host</td></tr>
<tr><td>broker.mqChannels.networkRoute.prefetch</td><td>broker.mq-channels.network-route.prefetch</td><td>BROKER_MQCHANNELS_NETWORK_ROUTE_PREFETCH</td><td>100</td><td>Maximum number of AMQP consumers for network route control messages</td></tr>
<tr><td>broker.mqChannels.data.url</td><td>broker.mq-channels.data.url</td><td>BROKER_MQCHANNELS_DATA_URL</td><td></td><td>Data message host</td></tr>
<tr><td>broker.mqChannels.data.persistent</td><td>broker.mq-channels.data.persistent</td><td>BROKER_MQCHANNELS_DATA_PERSISTENT</td><td>false</td><td>Persistent delivery for data messages</td></tr>
<tr><td>broker.db.apiScopes</td><td>broker.api-scopes</td><td>BROKER_API_SCOPES</td><td></td><td>API scope settings</td></tr>
</tbody></table>
</div>
<h3 id="detailed-explanation-2"><a class="header" href="#detailed-explanation-2">Detailed Explanation</a></h3>
<ul>
<li>
<p>The purpose of specifying the Authentication Service URL (<code>broker.auth</code>) is to verify the
legitimacy of API calls, including user accounts and clients.</p>
</li>
<li>
<p>MQ channels:</p>
<ul>
<li>As the Sylvia-IoT Message Broker Service is a critical module that determines performance,
many configurations are stored in memory. These configurations need to be propagated to
various instances of the cluster through <strong>Control Channel Messages</strong> via message queues when
API changes are made.
<ul>
<li>For relevant details, please refer to the <a href="../arch/cache.html"><strong>Cache</strong></a> chapter.</li>
</ul>
</li>
<li><strong>data</strong> represents the <strong>Data Channel Message</strong>, which records all data into the
<strong>sylvia-iot-data</strong> module.
<ul>
<li>If no parameters are specified (or JSON5 is set to <strong>null</strong>), no data will be stored.</li>
<li>For relevant details, please refer to the <a href="../arch/flow.html"><strong>Data Flow</strong></a> chapter.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>API scopes: Please refer to the explanation in the <strong>Authentication Service</strong> section.</p>
</li>
</ul>
<h2 id="core-manager-service-coremgr"><a class="header" href="#core-manager-service-coremgr">Core Manager Service (coremgr)</a></h2>
<div class="table-wrapper"><table><thead><tr><th>JSON5</th><th>CLI Parameters</th><th>Environment Variables</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td>coremgr.auth</td><td>coremgr.auth</td><td>COREMGR_AUTH</td><td>http://localhost:1080/auth</td><td>Authentication service URL</td></tr>
<tr><td>coremgr.broker</td><td>coremgr.broker</td><td>COREMGR_BROKER</td><td>http://localhost:2080/broker</td><td>Message broker service URL</td></tr>
<tr><td>coremgr.mq.engine.amqp</td><td>coremgr.mq.engine.amqp</td><td>COREMGR_MQ_ENGINE_AMQP</td><td>rabbitmq</td><td>AMQP type</td></tr>
<tr><td>coremgr.mq.engine.mqtt</td><td>coremgr.mq.engine.mqtt</td><td>COREMGR_MQ_ENGINE_MQTT</td><td>emqx</td><td>MQTT type</td></tr>
<tr><td>coremgr.mq.rabbitmq.username</td><td>coremgr.mq.rabbitmq.username</td><td>COREMGR_MQ_RABBITMQ_USERNAME</td><td>guest</td><td>RabbitMQ administrator account</td></tr>
<tr><td>coremgr.mq.rabbitmq.password</td><td>coremgr.mq.rabbitmq.password</td><td>COREMGR_MQ_RABBITMQ_PASSWORD</td><td>guest</td><td>RabbitMQ administrator password</td></tr>
<tr><td>coremgr.mq.rabbitmq.ttl</td><td>coremgr.mq.rabbitmq.ttl</td><td>COREMGR_MQ_RABBITMQ_TTL</td><td></td><td>RabbitMQ default message TTL (seconds)</td></tr>
<tr><td>coremgr.mq.rabbitmq.length</td><td>coremgr.mq.rabbitmq.length</td><td>COREMGR_MQ_RABBITMQ_LENGTH</td><td></td><td>RabbitMQ default maximum number of messages in queues</td></tr>
<tr><td>coremgr.mq.rabbitmq.hosts</td><td>coremgr.mq.rabbitmq.hosts</td><td>COREMGR_MQ_RABBITMQ_HOSTS</td><td></td><td>(Reserved)</td></tr>
<tr><td>coremgr.mq.emqx.apiKey</td><td>coremgr.mq.emqx.apikey</td><td>COREMGR_MQ_EMQX_APIKEY</td><td></td><td>EMQX management API key</td></tr>
<tr><td>coremgr.mq.emqx.apiSecret</td><td>coremgr.mq.emqx.apisecret</td><td>COREMGR_MQ_EMQX_APISECRET</td><td></td><td>EMQX management API secret</td></tr>
<tr><td>coremgr.mq.emqx.hosts</td><td>coremgr.mq.emqx.hosts</td><td>COREMGR_MQ_EMQX_HOSTS</td><td></td><td>(Reserved)</td></tr>
<tr><td>coremgr.mq.rumqttd.mqttPort</td><td>coremgr.mq.rumqttd.mqtt-port</td><td>COREMGR_MQ_RUMQTTD_MQTT_PORT</td><td>1883</td><td>rumqttd MQTT port</td></tr>
<tr><td>coremgr.mq.rumqttd.mqttsPort</td><td>coremgr.mq.rumqttd.mqtts-port</td><td>COREMGR_MQ_RUMQTTD_MQTTS_PORT</td><td>8883</td><td>rumqttd MQTTS port</td></tr>
<tr><td>coremgr.mq.rumqttd.consolePort</td><td>coremgr.mq.rumqttd.console-port</td><td>COREMGR_MQ_RUMQTTD_CONSOLE_PORT</td><td>18083</td><td>rumqttd management API port</td></tr>
<tr><td>coremgr.mqChannels.data.url</td><td>coremgr.mq-channels.data.url</td><td>COREMGR_MQCHANNELS_DATA_URL</td><td></td><td>Data message host</td></tr>
<tr><td>coremgr.mqChannels.data.persistent</td><td>coremgr.mq-channels.data.persistent</td><td>COREMGR_MQCHANNELS_DATA_PERSISTENT</td><td>false</td><td>Persistent delivery for data messages</td></tr>
</tbody></table>
</div>
<h3 id="detailed-explanation-3"><a class="header" href="#detailed-explanation-3">Detailed Explanation</a></h3>
<ul>
<li>MQ channels:
<ul>
<li><strong>data</strong> represents the <strong>Data Channel Message</strong>.
<ul>
<li>Currently, coremgr supports recording HTTP request content for all API requests except
GET. Enabling the data channel will record the API usage history.</li>
<li>If no parameters are specified (or JSON5 is set to <strong>null</strong>), no data will be stored.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="core-manager-command-line-interface-coremgr-cli"><a class="header" href="#core-manager-command-line-interface-coremgr-cli">Core Manager Command-Line Interface (coremgr-cli)</a></h2>
<div class="table-wrapper"><table><thead><tr><th>JSON5</th><th>CLI Parameters</th><th>Environment Variables</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td>coremgrCli.auth</td><td>coremgr-cli.auth</td><td>COREMGRCLI_AUTH</td><td>http://localhost:1080/auth</td><td>Authentication service URL</td></tr>
<tr><td>coremgrCli.coremgr</td><td>coremgr-cli.coremgr</td><td>COREMGRCLI_COREMGR</td><td>http://localhost:3080/coremgr</td><td>Core manager service URL</td></tr>
<tr><td>coremgrCli.data</td><td>coremgr-cli.data</td><td>COREMGRCLI_DATA</td><td>http://localhost:4080/data</td><td>Data service URL</td></tr>
<tr><td>coremgrCli.clientId</td><td>coremgr-cli.client-id</td><td>COREMGRCLI_CLIENT_ID</td><td></td><td>CLI client ID</td></tr>
<tr><td>coremgrCli.redirectUri</td><td>coremgr-cli.redirect-uri</td><td>COREMGRCLI_REDIRECT_URI</td><td></td><td>CLI client redirect URI</td></tr>
</tbody></table>
</div>
<h2 id="data-service-data"><a class="header" href="#data-service-data">Data Service (data)</a></h2>
<div class="table-wrapper"><table><thead><tr><th>JSON5</th><th>CLI Parameters</th><th>Environment Variables</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td>data.auth</td><td>data.auth</td><td>DATA_AUTH</td><td>http://localhost:1080/auth</td><td>Authentication service URL</td></tr>
<tr><td>data.broker</td><td>data.broker</td><td>DATA_BROKER</td><td>http://localhost:2080/broker</td><td>Message broker service URL</td></tr>
<tr><td>data.db.engine</td><td>data.db.engine</td><td>DATA_DB_ENGINE</td><td>sqlite</td><td>Database type</td></tr>
<tr><td>data.db.mongodb.url</td><td>data.db.mongodb.url</td><td>DATA_DB_MONGODB_URL</td><td>mongodb://localhost:27017</td><td>MongoDB connection URL</td></tr>
<tr><td>data.db.mongodb.database</td><td>data.db.mongodb.database</td><td>DATA_DB_MONGODB_DATABASE</td><td>data</td><td>MongoDB database name</td></tr>
<tr><td>data.db.mongodb.poolSize</td><td>data.db.mongodb.poolsize</td><td>DATA_DB_MONGODB_POOLSIZE</td><td></td><td>Maximum number of MongoDB connections</td></tr>
<tr><td>data.db.sqlite.path</td><td>data.db.sqlite.path</td><td>DATA_DB_SQLITE_PATH</td><td>data.db</td><td>SQLite file location</td></tr>
<tr><td>data.mqChannels.broker.url</td><td>data.mq-channels.broker.url</td><td>DATA_MQCHANNELS_BROKER_URL</td><td>amqp://localhost</td><td>Data message host</td></tr>
<tr><td>data.mqChannels.broker.prefetch</td><td>data.mq-channels.broker.prefetch</td><td>DATA_MQCHANNELS_BROKER_PREFETCH</td><td>100</td><td>Maximum number of AMQP consumers for data messages</td></tr>
<tr><td>data.mqChannels.broker.sharedPrefix</td><td>data.mq-channels.broker.sharedprefix</td><td>DATA_MQCHANNELS_BROKER_SHAREDPREFIX</td><td>$share/sylvia-iot-data/</td><td>MQTT shared subscription prefix</td></tr>
<tr><td>data.mqChannels.coremgr.url</td><td>data.mq-channels.coremgr.url</td><td>DATA_MQCHANNELS_COREMGR_URL</td><td>amqp://localhost</td><td>Data message host</td></tr>
<tr><td>data.mqChannels.coremgr.prefetch</td><td>data.mq-channels.coremgr.prefetch</td><td>DATA_MQCHANNELS_COREMGR_PREFETCH</td><td>100</td><td>Maximum number of AMQP consumers for data messages</td></tr>
<tr><td>data.mqChannels.coremgr.sharedPrefix</td><td>data.mq-channels.coremgr.sharedprefix</td><td>DATA_MQCHANNELS_COREMGR_SHAREDPREFIX</td><td>$share/sylvia-iot-data/</td><td>MQTT shared subscription prefix</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../guide/quick.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../arch/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../guide/quick.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../arch/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
